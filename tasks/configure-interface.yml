---
- name: "Check if interface {{ item.interface }} is managed"
  command: |
    grep 'Generated by VDSM' /etc/sysconfig/network-scripts/ifcfg-{{ item.interface }}
  register: interface_grep
  failed_when: False
  changed_when: False
- name: "Set explicit network config from template for {{ item.interface }}"
  copy:
    content: "{{ item.config }}"
    dest: "/etc/sysconfig/network-scripts/ifcfg-{{ item.interface }}"
  when: interface_grep.rc != 0 or (override_vdsm_net is defined and override_vdsm_net)
  notify:
    - reload network
- name: "Set keys for network config from template for {{ item.interface }}"
  copy:
    content: "{{ item.key_content }}"
    dest: "/etc/sysconfig/network-scripts/keys-{{ item.interface }}"
  when: item.key_content is defined
